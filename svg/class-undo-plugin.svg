<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="910px" style="width:729px;height:910px;" version="1.1" viewBox="0 0 729 910" width="729px"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="107" x="315.5" y="16.708">Undo Plugin</text><rect fill="#FEFECE" filter="url(#f1)" height="73.6094" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="7" y="136.9531"/><ellipse cx="68.25" cy="152.9531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M64.1719,148.7188 L64.1719,146.5625 L71.5625,146.5625 L71.5625,148.7188 L69.0938,148.7188 L69.0938,156.7969 L71.5625,156.7969 L71.5625,158.9531 L64.1719,158.9531 L64.1719,156.7969 L66.6406,156.7969 L66.6406,148.7188 L64.1719,148.7188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="99" x="88.75" y="157.1074">CommandPlugin</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="8" x2="236" y1="168.9531" y2="168.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="8" x2="236" y1="176.9531" y2="176.9531"/><ellipse cx="18" cy="188.8555" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="24" x="27" y="191.1636">bool</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="55" y="191.1636">onBeforeExecute</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="165" y="191.1636">(Command)</text><ellipse cx="18" cy="201.6602" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="27" y="203.9683">onAfterExecute</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="125" y="203.9683">(Command)</text><rect fill="#FEFECE" filter="url(#f1)" height="48" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="87.25" y="28.9531"/><ellipse cx="102.25" cy="44.9531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M98.1719,40.7188 L98.1719,38.5625 L105.5625,38.5625 L105.5625,40.7188 L103.0938,40.7188 L103.0938,48.7969 L105.5625,48.7969 L105.5625,50.9531 L98.1719,50.9531 L98.1719,48.7969 L100.6406,48.7969 L100.6406,40.7188 L98.1719,40.7188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="37" x="116.25" y="49.1074">Plugin</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="88.25" x2="155.25" y1="60.9531" y2="60.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="88.25" x2="155.25" y1="68.9531" y2="68.9531"/><rect fill="#FEFECE" filter="url(#f1)" height="99.2188" style="stroke: #A80036; stroke-width: 1.5;" width="232" x="6" y="536.4531"/><ellipse cx="82.25" cy="552.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M85.2188,558.0938 Q84.6406,558.3906 84,558.5391 Q83.3594,558.6875 82.6563,558.6875 Q80.1563,558.6875 78.8359,557.0391 Q77.5156,555.3906 77.5156,552.2656 Q77.5156,549.1406 78.8359,547.4844 Q80.1563,545.8281 82.6563,545.8281 Q83.3594,545.8281 84.0078,545.9844 Q84.6563,546.1406 85.2188,546.4375 L85.2188,549.1563 Q84.5938,548.5781 84,548.3047 Q83.4063,548.0313 82.7813,548.0313 Q81.4375,548.0313 80.75,549.1016 Q80.0625,550.1719 80.0625,552.2656 Q80.0625,554.3594 80.75,555.4297 Q81.4375,556.5 82.7813,556.5 Q83.4063,556.5 84,556.2266 Q84.5938,555.9531 85.2188,555.375 L85.2188,558.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="102.75" y="556.6074">UndoPlugin</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="237" y1="568.4531" y2="568.4531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="14" y="577.3555"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="26" y="582.6636">RecoverableCommand[]</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="165" y="582.6636">undoStack</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="14" y="590.1602"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="26" y="595.4683">RecoverableCommand[]</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="165" y="595.4683">redoStack</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="237" y1="602.0625" y2="602.0625"/><ellipse cx="17" cy="613.9648" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="26" y="616.2729">onUndo</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="8" x="75" y="616.2729">()</text><ellipse cx="17" cy="626.7695" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48" x="26" y="629.0776">onRedo</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="8" x="74" y="629.0776">()</text><polygon fill="#FBFB77" filter="url(#f1)" points="273.25,270.9531,273.25,901.3984,720.25,901.3984,720.25,280.9531,710.25,270.9531,273.25,270.9531" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="273.25,270.9531,273.25,581.9531,237.223,585.9531,273.25,589.9531,273.25,901.3984,720.25,901.3984,720.25,280.9531,710.25,270.9531,273.25,270.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="710.25" x2="710.25" y1="270.9531" y2="280.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720.25" x2="710.25" y1="280.9531" y2="280.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="279.25" y="288.02">onBeforeExecute(Command $command) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="295.25" y="303.1528">if (!($command instanceOf RecoverableCommand)) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="311.25" y="318.2856">if ($command-&gt;getInput()-&gt;isInteractive()) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="327.25" y="333.4185">// Warn the user: "Operation can not be undone. Continue?"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="327.25" y="348.5513">// return true on "yes", false on "no"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="311.25" y="363.6841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="295.25" y="378.8169">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="295.25" y="393.9497">return true;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="279.25" y="409.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="283.25" y="424.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="279.25" y="439.3481">onAfterExecute(Command $command) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="295.25" y="454.481">if ($command instanceOf RecoverableCommand) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="311.25" y="469.6138">array_push($this-&gt;undoStack, $command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="311.25" y="484.7466">$this-&gt;redoStack = [];</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="295.25" y="499.8794">} else {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="311.25" y="515.0122">$this-&gt;undoStack = [];</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="295.25" y="530.145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="279.25" y="545.2778">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="283.25" y="560.4106"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="279.25" y="575.5435">onUndo() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="295.25" y="590.6763">$command = array_pop($this-&gt;undoStack);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="295.25" y="605.8091">if (empty($command)) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="311.25" y="620.9419">return;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="295.25" y="636.0747">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="295.25" y="651.2075">array_push($this-&gt;redoStack, $command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="295.25" y="666.3403">$command-&gt;undo();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="279.25" y="681.4731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="283.25" y="696.606"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="279.25" y="711.7388">onRedo() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="295.25" y="726.8716">$command = array_pop($this-&gt;redoStack);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="295.25" y="742.0044">if (empty($command)) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="311.25" y="757.1372">return;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="295.25" y="772.27">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="295.25" y="787.4028">$dispatcher = $command-&gt;getDispatcher();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="295.25" y="802.5356">if ($dispatcher-&gt;trigger('beforeExecute', $command)) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="311.25" y="817.6685">$command-&gt;redo();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="311.25" y="832.8013">$stack = $this-&gt;redoStack;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="311.25" y="847.9341">$dispatcher-&gt;trigger('afterExecute', $command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="311.25" y="863.0669">$this-&gt;redoStack = $stack;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="295.25" y="878.1997">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="279.25" y="893.3325">}</text><path d="M121.5,97.3861 C121.5,110.2851 121.5,124.2731 121.5,136.6671 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="114.5,97.1801,121.5,77.1801,128.5,97.1801,114.5,97.1801" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M121.5,231.1991 C121.5,312.0971 121.5,459.9501 121.5,536.3611 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="114.5,230.9781,121.5,210.9781,128.5,230.9781,114.5,230.9781" style="stroke: #A80036; stroke-width: 1.0;"/></g></svg>